<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>¿Quién Quiere Ser Millonario?</title>
    <link rel="stylesheet" href="shared.css" />
    <style>
      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(
          135deg,
          #0f0f0f 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        color: white;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .container {
        width: 90%;
        max-width: 800px;
        text-align: center;
      }

      /* Pantalla de bienvenida */
      .welcome-screen {
        display: block;
      }

      .welcome-screen h1 {
        font-size: 3rem;
        margin-bottom: 30px;
        background: linear-gradient(45deg, #ffd700, #ffed4e);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      .name-input {
        margin: 30px 0;
      }

      .name-input input {
        padding: 15px 20px;
        font-size: 1.2rem;
        border: 2px solid #ffd700;
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        text-align: center;
        min-width: 300px;
      }

      .name-input input::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      .start-btn {
        padding: 15px 40px;
        font-size: 1.2rem;
        background: linear-gradient(45deg, #ffd700, #ffed4e);
        color: #000;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        transition: transform 0.3s ease;
      }

      .start-btn:hover {
        transform: scale(1.05);
      }

      /* Pantalla del juego */
      .game-screen {
        display: none;
      }

      .player-info {
        margin-bottom: 30px;
        font-size: 1.3rem;
      }

      .player-name {
        color: #ffd700;
        font-weight: bold;
      }

      .question-container {
        background: rgba(0, 0, 0, 0.7);
        border: 3px solid #ffd700;
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
      }

      .question-number {
        font-size: 1.1rem;
        color: #ffd700;
        margin-bottom: 15px;
      }

      .question-text {
        font-size: 1.4rem;
        margin-bottom: 30px;
        line-height: 1.4;
      }

      .options-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        max-width: 600px;
        margin: 0 auto;
      }

      .option {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border: 2px solid #4a4a4a;
        border-radius: 15px;
        padding: 15px 20px;
        font-size: 1rem;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: left;
        display: flex;
        align-items: center;
      }

      .option:hover {
        border-color: #ffd700;
        background: linear-gradient(135deg, #2a2a3e 0%, #26334e 100%);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
      }

      .option.selected {
        border-color: #ffd700;
        background: linear-gradient(135deg, #ffd700, #ffed4e);
        color: #000;
      }

      .option.correct {
        border-color: #4caf50;
        background: linear-gradient(135deg, #4caf50, #45a049);
        color: white;
        animation: pulse-correct 2s infinite;
      }

      .option.incorrect {
        border-color: #f44336;
        background: linear-gradient(135deg, #f44336, #d32f2f);
        color: white;
      }

      .option.eliminated {
        opacity: 0.3;
        pointer-events: none;
        background: rgba(100, 100, 100, 0.2) !important;
        border-color: #666 !important;
      }

      .option-letter {
        background: #ffd700;
        color: #000;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 15px;
        flex-shrink: 0;
      }

      .lifelines {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 30px;
      }

      .lifeline {
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid #666;
        border-radius: 10px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .lifeline:hover {
        border-color: #ffd700;
        background: rgba(255, 215, 0, 0.1);
      }

      .lifeline.used {
        opacity: 0.3;
        cursor: not-allowed;
        background: rgba(100, 100, 100, 0.2);
        border-color: #666;
      }

      .score-display {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.8);
        border: 2px solid #ffd700;
        border-radius: 10px;
        padding: 15px;
        color: #ffd700;
        font-weight: bold;
      }

      .next-btn {
        background: linear-gradient(45deg, #4caf50, #66bb6a, #4caf50);
        background-size: 200% 200%;
        color: white;
        border: none;
        border-radius: 20px;
        padding: 18px 40px;
        font-size: 1.2rem;
        font-weight: bold;
        cursor: pointer;
        margin: 25px;
        transition: all 0.4s ease;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        overflow: hidden;
        animation: pulseGreen 2s infinite;
        opacity: 1;
        transform: translateY(0);
      }

      .next-btn:hover {
        transform: scale(1.08) translateY(-2px);
        box-shadow: 0 6px 25px rgba(76, 175, 80, 0.5);
        background-position: 100% 0;
      }

      .next-btn:active {
        transform: scale(1.02) translateY(0);
      }

      .next-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .next-btn:hover::before {
        left: 100%;
      }

      .next-btn[disabled] {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
        animation: none;
      }

      @keyframes pulseGreen {
        0%,
        100% {
          box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        50% {
          box-shadow: 0 4px 25px rgba(76, 175, 80, 0.6);
        }
      }

      .game-over {
        text-align: center;
        padding: 40px;
        background: rgba(0, 0, 0, 0.8);
        border: 3px solid #ffd700;
        border-radius: 20px;
        margin: 20px 0;
      }

      .final-score {
        font-size: 2rem;
        color: #ffd700;
        margin: 20px 0;
        font-weight: bold;
      }

      .play-again-btn {
        background: linear-gradient(45deg, #ffd700, #ffed4e);
        color: #000;
        border: none;
        border-radius: 15px;
        padding: 15px 30px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        margin: 10px;
        transition: transform 0.3s ease;
      }

      .play-again-btn:hover {
        transform: scale(1.05);
      }

      @keyframes pulse-correct {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
        }
        50% {
          box-shadow: 0 0 20px rgba(76, 175, 80, 0.7);
        }
      }

      @media (max-width: 768px) {
        .container {
          width: 95%;
        }
        .welcome-screen h1 {
          font-size: 2rem;
        }
        .options-container {
          grid-template-columns: 1fr;
        }
        .score-display {
          position: relative;
          top: auto;
          right: auto;
          margin: 20px auto;
        }
        .name-input input {
          min-width: 250px;
        }
      }

      /* Modal para pregunta al público */
      .audience-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .audience-modal.show {
        display: flex;
      }

      .audience-content {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border: 3px solid #ffd700;
        border-radius: 20px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
      }

      .audience-title {
        text-align: center;
        color: #ffd700;
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 20px;
      }

      .result-item {
        display: flex;
        align-items: center;
        margin: 15px 0;
        font-size: 1.1rem;
      }

      .result-letter {
        background: #ffd700;
        color: #000;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 15px;
        flex-shrink: 0;
      }

      .result-bar-container {
        flex: 1;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        height: 25px;
        margin-right: 15px;
        overflow: hidden;
        position: relative;
      }

      .result-bar {
        height: 100%;
        background: linear-gradient(90deg, #ffd700 0%, #ffed4e 100%);
        width: 0%;
        transition: width 1.5s ease-in-out;
        border-radius: 10px;
      }

      .result-percentage {
        color: #ffd700;
        font-weight: bold;
        min-width: 50px;
        text-align: right;
      }

      .close-audience-btn {
        background: linear-gradient(45deg, #ffd700, #ffed4e);
        color: #000;
        border: none;
        border-radius: 15px;
        padding: 12px 30px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        display: block;
        margin: 20px auto 0;
        transition: transform 0.3s ease;
      }

      .close-audience-btn:hover {
        transform: scale(1.05);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Pantalla de bienvenida -->
      <div class="welcome-screen" id="welcomeScreen">
        <h1>¿Quién Quiere Ser Millonario?</h1>
        <div class="name-input">
          <input
            type="text"
            id="playerName"
            placeholder="Ingresa tu nombre"
            maxlength="20"
          />
        </div>
        <button class="start-btn" onclick="startGame()">
          ¡Comenzar Juego!
        </button>
      </div>

      <!-- Pantalla del juego -->
      <div class="game-screen" id="gameScreen">
        <div class="score-display">
          Pregunta: <span id="currentQuestionNum">1</span>/8<br />
          Premio: $<span id="currentPrize">1,000</span>
        </div>

        <div class="player-info">
          ¡Bienvenido/a,
          <span class="player-name" id="playerNameDisplay"></span>!
        </div>

        <div class="question-container">
          <div class="question-number">
            Pregunta <span id="questionNumber">1</span> de 8
          </div>
          <div class="question-text" id="questionText">
            Cargando pregunta...
          </div>

          <div class="options-container" id="optionsContainer">
            <!-- Las opciones se cargarán dinámicamente -->
          </div>
        </div>

        <div class="lifelines">
          <div
            class="lifeline"
            onclick="useFiftyFifty()"
            id="fiftyFiftyLifeline"
          >
            🔄 50:50
          </div>
          <div
            class="lifeline"
            onclick="useAudiencePoll()"
            id="audienceLifeline"
          >
            👥 Pregunta al Público
          </div>
        </div>

        <button
          class="next-btn"
          id="nextBtn"
          onclick="nextQuestion()"
          style="display: none"
        >
          <span id="nextBtnText">Siguiente Pregunta</span>
          <span id="nextBtnIcon"> ➤</span>
        </button>
      </div>

      <!-- Pantalla de game over -->
      <div class="game-over" id="gameOverScreen" style="display: none">
        <h2 id="gameOverTitle">¡Juego Terminado!</h2>
        <div class="final-score" id="finalScore">$0</div>
        <p id="gameOverMessage">¡Gracias por jugar!</p>
        <button class="play-again-btn" onclick="restartGame()">
          Jugar de Nuevo
        </button>
      </div>
    </div>

    <!-- Modal para pregunta al público -->
    <div class="audience-modal" id="audienceModal">
      <div class="audience-content">
        <div class="audience-title">👥 Pregunta al Público</div>
        <p style="text-align: center; margin-bottom: 20px; color: #ccc">
          Resultados de la votación del público:
        </p>
        <div class="audience-results" id="audienceResults">
          <!-- Los resultados se generarán dinámicamente -->
        </div>
        <button class="close-audience-btn" onclick="closeAudienceModal()">
          Cerrar
        </button>
      </div>
    </div>

    <script>
      // Estado del juego simplificado
      let gameState = {
        playerName: "",
        currentQuestionIndex: 0,
        questions: [],
        selectedOption: null,
        score: 1000,
        lifelinesUsed: {
          fiftyFifty: false,
          audience: false,
        },
      };

      // Premios por pregunta
      const prizes = [1000, 2000, 5000, 10000, 25000, 50000, 100000, 1000000];

      // Iniciar el juego
      async function startGame() {
        const playerName = document.getElementById("playerName").value.trim();
        if (!playerName) {
          alert("Por favor ingresa tu nombre");
          return;
        }

        gameState.playerName = playerName;

        // Cargar preguntas
        await loadQuestions();

        // Mostrar pantalla del juego
        document.getElementById("welcomeScreen").style.display = "none";
        document.getElementById("gameScreen").style.display = "block";
        document.getElementById("playerNameDisplay").textContent = playerName;

        // Cargar primera pregunta
        loadCurrentQuestion();
      }

      // Cargar preguntas desde la API
      async function loadQuestions() {
        try {
          const response = await fetch("/api/questions");
          if (!response.ok) {
            throw new Error("Error cargando preguntas");
          }
          const data = await response.json();
          gameState.questions = data.questions || [];
          console.log(`✅ ${gameState.questions.length} preguntas cargadas`);
        } catch (error) {
          console.error("❌ Error cargando preguntas:", error);
          alert("Error cargando preguntas. Por favor recarga la página.");
        }
      }

      // Cargar pregunta actual
      function loadCurrentQuestion() {
        if (gameState.currentQuestionIndex >= gameState.questions.length) {
          endGame(true); // Ganó el juego
          return;
        }

        const question = gameState.questions[gameState.currentQuestionIndex];
        const questionNum = gameState.currentQuestionIndex + 1;

        // Actualizar UI
        document.getElementById("questionNumber").textContent = questionNum;
        document.getElementById("currentQuestionNum").textContent = questionNum;
        document.getElementById("currentPrize").textContent =
          prizes[gameState.currentQuestionIndex].toLocaleString();
        document.getElementById("questionText").textContent = question.question;

        // Limpiar selección previa
        gameState.selectedOption = null;

        // Cargar opciones
        loadOptions(question.options);

        // Ocultar botón siguiente
        document.getElementById("nextBtn").style.display = "none";
      }

      // Cargar opciones de la pregunta
      function loadOptions(options) {
        const container = document.getElementById("optionsContainer");
        container.innerHTML = "";

        Object.keys(options).forEach((letter) => {
          const option = document.createElement("div");
          option.className = "option";
          option.setAttribute("data-option", letter);
          option.onclick = () => selectOption(letter);

          option.innerHTML = `
            <div class="option-letter">${letter}</div>
            <div>${options[letter]}</div>
          `;

          container.appendChild(option);
        });
      }

      // Seleccionar opción
      function selectOption(letter) {
        if (gameState.selectedOption) return; // Ya seleccionó

        gameState.selectedOption = letter;
        const question = gameState.questions[gameState.currentQuestionIndex];
        const isCorrect = letter === question.correctAnswer;

        // Marcar opción seleccionada
        const selectedElement = document.querySelector(
          `[data-option="${letter}"]`
        );
        selectedElement.classList.add("selected");

        // Después de 2 segundos, mostrar resultado
        setTimeout(() => {
          revealAnswer(question.correctAnswer, isCorrect);
        }, 2000);
      }

      // Revelar la respuesta correcta
      function revealAnswer(correctAnswer, wasCorrect) {
        // Marcar respuesta correcta
        const correctElement = document.querySelector(
          `[data-option="${correctAnswer}"]`
        );
        correctElement.classList.add("correct");

        // Si la respuesta fue incorrecta, marcar como tal
        if (!wasCorrect && gameState.selectedOption) {
          const incorrectElement = document.querySelector(
            `[data-option="${gameState.selectedOption}"]`
          );
          incorrectElement.classList.add("incorrect");
        }

        // Deshabilitar todas las opciones
        document.querySelectorAll(".option").forEach((option) => {
          option.style.pointerEvents = "none";
        });

        // Mostrar resultado después de 3 segundos
        setTimeout(() => {
          if (wasCorrect) {
            if (
              gameState.currentQuestionIndex ===
              gameState.questions.length - 1
            ) {
              // Última pregunta - ganó el juego
              endGame(true);
            } else {
              // Siguiente pregunta
              const nextBtn = document.getElementById("nextBtn");
              const btnText = document.getElementById("nextBtnText");
              const btnIcon = document.getElementById("nextBtnIcon");

              // Texto dinámico según la pregunta
              const questionNum = gameState.currentQuestionIndex + 2; // +2 porque es la siguiente
              const totalQuestions = gameState.questions.length;

              if (questionNum === totalQuestions) {
                btnText.textContent = "¡Pregunta Final!";
                btnIcon.textContent = " 🏆";
              } else {
                btnText.textContent = `Pregunta ${questionNum}/${totalQuestions}`;
                btnIcon.textContent = " ➤";
              }

              nextBtn.style.display = "block";

              // Animación de entrada
              nextBtn.style.opacity = "0";
              nextBtn.style.transform = "translateY(20px)";
              setTimeout(() => {
                nextBtn.style.transition = "all 0.5s ease";
                nextBtn.style.opacity = "1";
                nextBtn.style.transform = "translateY(0)";
              }, 100);
            }
          } else {
            // Perdió el juego
            endGame(false);
          }
        }, 3000);
      }

      // Siguiente pregunta
      function nextQuestion() {
        // Animación del botón antes de cambiar pregunta
        const nextBtn = document.getElementById("nextBtn");
        const btnText = document.getElementById("nextBtnText");
        const btnIcon = document.getElementById("nextBtnIcon");

        btnText.textContent = "Cargando...";
        btnIcon.textContent = " ⏳";
        nextBtn.disabled = true;
        nextBtn.style.pointerEvents = "none";

        setTimeout(() => {
          gameState.currentQuestionIndex++;
          gameState.score = prizes[gameState.currentQuestionIndex - 1];
          loadCurrentQuestion();

          // Restaurar botón para la próxima vez
          nextBtn.disabled = false;
          nextBtn.style.pointerEvents = "auto";
        }, 800);
      }

      // Terminar juego
      function endGame(won) {
        const gameOverScreen = document.getElementById("gameOverScreen");
        const gameScreen = document.getElementById("gameScreen");
        const title = document.getElementById("gameOverTitle");
        const score = document.getElementById("finalScore");
        const message = document.getElementById("gameOverMessage");

        gameScreen.style.display = "none";
        gameOverScreen.style.display = "block";

        if (won) {
          title.textContent = "¡FELICIDADES! ¡GANASTE!";
          score.textContent = `$${prizes[prizes.length - 1].toLocaleString()}`;
          message.textContent = "¡Eres el nuevo millonario!";
        } else {
          title.textContent = "¡Juego Terminado!";
          score.textContent = `$${gameState.score.toLocaleString()}`;
          message.textContent = "No te preocupes, ¡puedes intentarlo de nuevo!";
        }
      }

      // Reiniciar juego
      function restartGame() {
        gameState = {
          playerName: "",
          currentQuestionIndex: 0,
          questions: [],
          selectedOption: null,
          score: 1000,
          lifelinesUsed: {
            fiftyFifty: false,
            audience: false,
          },
        };

        document.getElementById("gameOverScreen").style.display = "none";
        document.getElementById("welcomeScreen").style.display = "block";
        document.getElementById("playerName").value = "";

        // Resetear comodines
        document.getElementById("fiftyFiftyLifeline").classList.remove("used");
        document.getElementById("audienceLifeline").classList.remove("used");
      }

      // Comodín 50:50
      function useFiftyFifty() {
        if (gameState.lifelinesUsed.fiftyFifty || gameState.selectedOption)
          return;

        gameState.lifelinesUsed.fiftyFifty = true;
        document.getElementById("fiftyFiftyLifeline").classList.add("used");

        const question = gameState.questions[gameState.currentQuestionIndex];
        const correctAnswer = question.correctAnswer;
        const options = Object.keys(question.options);
        const incorrectOptions = options.filter((opt) => opt !== correctAnswer);

        // Eliminar 2 opciones incorrectas aleatoriamente
        const toEliminate = incorrectOptions
          .sort(() => 0.5 - Math.random())
          .slice(0, 2);

        toEliminate.forEach((option) => {
          const element = document.querySelector(`[data-option="${option}"]`);
          element.classList.add("eliminated");
        });
      }

      // Comodín pregunta al público
      function useAudiencePoll() {
        if (gameState.lifelinesUsed.audience || gameState.selectedOption)
          return;

        gameState.lifelinesUsed.audience = true;
        document.getElementById("audienceLifeline").classList.add("used");

        const question = gameState.questions[gameState.currentQuestionIndex];
        const correctAnswer = question.correctAnswer;

        // Generar porcentajes simulados (favoreciendo la respuesta correcta)
        const percentages = generateAudiencePercentages(correctAnswer);

        // Mostrar modal
        showAudienceResults(percentages);
      }

      // Generar porcentajes para pregunta al público
      function generateAudiencePercentages(correctAnswer) {
        const options = ["A", "B", "C", "D"];
        const percentages = {};

        // La respuesta correcta tendrá entre 40-70%
        const correctPercent = Math.floor(Math.random() * 30) + 40;
        percentages[correctAnswer] = correctPercent;

        // Distribuir el resto
        const remaining = 100 - correctPercent;
        const otherOptions = options.filter((opt) => opt !== correctAnswer);

        let remainingPercent = remaining;
        otherOptions.forEach((option, index) => {
          if (index === otherOptions.length - 1) {
            percentages[option] = remainingPercent;
          } else {
            const percent = Math.floor(
              Math.random() *
                (remainingPercent - (otherOptions.length - index - 1))
            );
            percentages[option] = percent;
            remainingPercent -= percent;
          }
        });

        return percentages;
      }

      // Mostrar resultados de pregunta al público
      function showAudienceResults(percentages) {
        const modal = document.getElementById("audienceModal");
        const resultsContainer = document.getElementById("audienceResults");

        resultsContainer.innerHTML = "";

        Object.keys(percentages).forEach((option) => {
          const resultItem = document.createElement("div");
          resultItem.className = "result-item";
          resultItem.innerHTML = `
            <div class="result-letter">${option}</div>
            <div class="result-bar-container">
              <div class="result-bar" style="width: ${percentages[option]}%"></div>
            </div>
            <div class="result-percentage">${percentages[option]}%</div>
          `;
          resultsContainer.appendChild(resultItem);
        });

        modal.classList.add("show");
      }

      // Cerrar modal de pregunta al público
      function closeAudienceModal() {
        document.getElementById("audienceModal").classList.remove("show");
      }

      // Permitir Enter para enviar nombre
      document
        .getElementById("playerName")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            startGame();
          }
        });
    </script>
  </body>
</html>
